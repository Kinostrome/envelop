# Building Plugins

When getting started with Envelop, you may not have to build your plugins. There is a high probability the functionality you seek has already been implemented and is available on the [Envelop Plugin Hub](/plugins).

Specific logic related to your organization's business needs might require you to implement your plugin from scratch. The simple Envelop plugin API allows you to solve your problems in a structured and reusable way.

## The Plugin interface

Envelop plugins are objects with handler functions that provide a contextual implementation for running logic before and after each phase, with a flexible API.

If you are using TypeScript, you can import the `Plugin` interface from `@envelop/core` package, for getting full type safety while building envelop plugins.

All plugins share the common plugin interface that can be found on GitHub.

https://github.com/n1ru4l/envelop/blob/main/packages/types/src/plugin.ts

## Building Your First Plugin

Here's a simple example that allows you to print the execution and parsing parameters.

```ts
import type { Plugin } from '@envelop/core'

const myPlugin: Plugin = {
  onParse({ params }) {
    console.log('Parse started!', { params })

    return result => {
      console.log('Parse done!', { result })
    }
  },
  onExecute({ args }) {
    console.log('Execution started!', { args })

    return {
      onExecuteDone: ({ result }) => {
        console.log('Execution done!', { result })
      }
    }
  }
}

const getEnveloped = envelop({
  plugins: [
    /// ... other plugins ...,
    myPlugin
  ]
})
```

## Adding Config Options to Your Plugin

Often plugins require additional configuration. A common pattern for doing this is by creating a factor function that returns a `Plugin`.

```ts
const myPlugin = (shouldPrintResult: boolean): Plugin => {
  return {
    onExecute({ args }) {
      console.log('Execution started!', { args })

      if (shouldPrintResult) {
        return {
          onExecuteDone: ({ result }) => {
            console.log('Execution done!', { result })
          }
        }
      }
    }
  }
}

const getEnveloped = envelop({
  plugins: [
    /// ... other plugins ...,
    myPlugin(true)
  ]
})
```

## Sharing Envelop Plugins

In case you want to publish a standalone envelop plugin as an npm package we recommend using `@envelop/core` as a `peerDependency`. By doing so we can reduce the likelihood of `@envelop/core` being instantiated multiple times due to a version mismatch and leading to unexpected behaviors.

The existing Envelop plugins within the envelop Monorepo serve as a good example. [The `@envelop/preload-assets` plugin is a simple example on how to setup a plugin package](https://github.com/n1ru4l/envelop/tree/main/packages/plugins/preload-assets).
